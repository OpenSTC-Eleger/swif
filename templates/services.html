<div class="page-header">
	<h1>
		<%= lang.viewsTitles.servicesList %>
		<sup class="badge"><%= nbServices %></sup>
	</h1>
</div>


<div class="container-fluid">

	<!-- Check if there is Services in the Database -->
	<% if(services.length != 0) { %>

		<!-- Table toolbar -->
		<div class="tableToolbar">
			<a href="#services/add" class="btn btn-primary"><i class="icon-plus"></i> <%= _.capitalize(lang.actions.addService) %></a>	

			<!--<form class="form-search pull-right">
				<div class="input-append">
					<input type="search" class="input-medium search-query" placeholder="<%= lang.actions.search %>..." autocomplete="off">
					<button type="submit" class="btn"><i class="icon-search icon-large"></i></button>
				</div>
			</form>-->
		</div>
		<!-- Table toolbar -->


		<!-- Table Requests -->
		<table class="table table-bordered table-hover table-striped">
			<thead>
				<tr>
					<th><%= _.capitalize(lang.name) %></th>
					<th><%= _.capitalize(lang.code) %></th>					
					<th><%= _.capitalize(lang.manager) %></th>
					<th><%= _.capitalize(lang.parentService) %></th>
					<th><%= _.capitalize(lang.technicalService) %></th>
				</tr>
			</thead>
			<tbody>
			<% for (var i = startPos; i < endPos; i++) { 
					var service = services[i];
				%>
								
				<!-- Service row -->
				<tr class="row-object" id="service_<%= service.id %>">
					<td>
						<a class="accordion-object" href="#collapse_<%= service.id %>">
							<i class="icon-pushpin">&nbsp;&nbsp;</i><%= service.name %>
						</a>
						<span class="object-actions invisible">
							<a href="#services/<%= service.id %>"><i class="icon-pencil"></i>&nbsp;<%= _.capitalize(lang.actions.update) %></a>
							
						</span>
					</td>
					<td><%= service.code %></td>
					<td><%= service.manager_id[1] %></td>
					<td><%= service.service_id[1] %></td>
					<td><%= (service.technical == true ? "<i class='icon-ok'></i>" : "")%></td>
				</tr>
				
				<!-- Claimer row -->
				<tr class="row-nested-objects-collapse" id="collapse_<%= service.id %>">
					<td colspan="5" class="nestedTD">
						<% if(service.user_ids.length != 0) { 
								var self = this;
								self.service = service; 
							%>
							<table class="table-nested-objects table table-striped table-condensed table-hover">
								<thead>
									<tr>
										<th><%= _.capitalize(lang.name) %></th>
										<th><%= _.capitalize(lang.login) %></th>
										<th><%= _.capitalize(lang.group) %></th>
										<th><%= _.capitalize(lang.email) %></th>
										<th><%= _.capitalize(lang.lastConnection) %></th>
									</tr>
								</thead>
								<tbody>
									<% _.each(service.user_ids, function (officer, i) { 								
												self.officer = officer
												self.groupName = "";
												_.each(app.collections.groups.models, function(group){									
													var groupJSON = group.toJSON();									
													if($.inArray(groupJSON.id, self.officer.groups_id)!=-1){	
														self.groupName = groupJSON.name;
													}
												});
											
										%>
										
										<tr class="row-nested-objects" id="<%= officer.id %>_<%= service.id %>">
											<td>
												<span><%= officer.name +" "+ officer.firstname %></span>&nbsp;
												<span class="nested-objects-actions invisible">
													<a href="#modalSaveOfficer" class="modalSaveOfficer" >
														<i class="icon-pencil displayInlineBlock" data-toggle="tooltip" 
															data-original-title="<%= _.capitalize(lang.actions.update) %>">&nbsp;<%= _.capitalize(lang.actions.update) %></i>
													</a> |																								
													<a href="#modalDeleteOfficer" class="modalDeleteOfficer" data-toggle="modal">
														<i class="icon-remove displayInlineBlock" data-toggle="tooltip" 
															data-original-title="<%= _.capitalize(lang.actions.delete) %>">&nbsp;<%= _.capitalize(lang.actions.delete) %></i>
													</a>
												</span>
											</td>
											
											<td><%= officer.login %></td>	
											<td><%= _(this.groupName).strRight('/') %></td>										
											<td><%= (officer.user_email != false ? officer.user_email : "") %></td>
											<td><% 
												if(officer.date != false){ %>
													<span data-toggle="tooltip"
													    data-original-title="<%= moment(officer.date, 'YYYY-MM-DD HH:mm:ss').fromNow() %>">
											    		<%= moment(officer.date, 'YYYY-MM-DD HH:mm:ss').format('LLL') %>
													</span>
												<% } %>
											</td>
										</tr>
									<% }); %>
								</tbody>
							</table>
						<% } else { %>
								<!-- No Service in to Display -->
								<div class="alert alert-info">
									<i class="icon-info-sign icon-large"></i> &nbsp;<%= lang.infoMessages.noOfficer %>.
								</div>
						<% } %>

							<div class="div-actions" >
								<button class="btn btn-primary btn-small no-outline addOfficer">
									<i class="icon-plus"></i>&nbsp; <%= _.capitalize(lang.actions.addOfficer) %>
								</button>
							</div>
					</td>
				</tr>

			<% }; %>
			</tbody>
		</table>


		<!-- Table pagination -->
		<div class="pagination pagination-right">
			<ul>
				<!-- First page button -->
				<% if(page-2 >= 1){ %>
					<li <%= ((page - 1) == 0 ? " class='disabled'" : "")%>><a href='#sites/page<%= 1 %>'><%= _.capitalize(lang.actions.first) %></a></li>
				<% } %>
				
				<!-- Previous page button -->
				<li <%= ((page - 1) == 0 ? " class='disabled'" : "")%>><a href='#sites/page<%=(page-1)%>'><%= _.capitalize(lang.actions.previousShort) %></a></li>
			
				<!-- [...] page Button -->
				<% 	if (page-2 > 1) { %>
						<li class="disabled"><a href='#'>...</a></li>
				<% } 
						
					for (var i=(page-2); i < (page+3); i++) {
						if(i >= 1 && i <= pageCount){ %>
							<li <%= (i === page ? " class='active'" : "")%>><a href='#sites/page<%=i%>'><%= i %></a></li>
						<% }

					} %>
					
				<!-- [...] page Button -->
				<% if (page+2 < pageCount) { %>
					<li class="disabled"><a href='#'>...</a></li>
				<% } %>
				
				<!-- Next page button -->
				<li <%= ((page + 1) > pageCount ? " class='disabled'" : "")%>><a href='#sites/page<%=(page+1)%>'><%= _.capitalize(lang.actions.nextShort) %></a></li>
				
				<!-- Last page button -->
				<% if(page+2 <= pageCount){ %>
					<li <%= ((page + 1) > pageCount ? " class='disabled'" : "")%>><a href='#sites/page<%= pageCount %>'><%= _.capitalize(lang.actions.end) %></a></li>
				<% } %>
			</ul>
		</div>
		<!-- /Table pagination -->

	<% }
	else { %>
		<div class="tableToolbar">
			<a href="#services/add" class="btn btn-primary"><i class="icon-plus"></i> <%= _.capitalize(lang.actions.addService) %></a>
		</div><br />

		<!-- No request in the Database -->
		<div class="alert alert-info">
			<i class="icon-info-sign icon-large"></i> &nbsp;<%= lang.infoMessages.noService %>.
		</div>

	<% } %>

</div>


<!-- Modal Form to add a new Serivice -->
<div id="modalSaveService" class="modal hide fade">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3><%= _.capitalize(lang.actions.addService) %></h3>
	</div>
	
	<div class="modal-body">
		<form id="formAddService" action="#" class="form-horizontal">

			<fieldset>
				<legend><%= lang.aboutTheService %></legend>
			
			<!-- Service name -->
			<div class="control-group">
				<label for="serviceName" class="control-label"><%= _.capitalize(lang.name) %>:</label>

				<div class="controls">
					<input type="text" id="serviceName" name="serviceName" required="required" />
					<span class="help-inline"></span>
				</div>
			</div>

			<!-- Service code -->
			<div class="control-group">
				<label for="serviceCode" class="control-label"><%= _.capitalize(lang.code) %>:</label>

				<div class="controls">
					<input type="text" id="serviceCode" name="serviceCode" required="required" />
					<span class="help-inline"></span>
				</div>
			</div>

			</fieldset>


			<fieldset>
				<legend><%= _.capitalize(lang.organization) %></legend>

				<!-- Service Manager -->
				<div class="control-group">
					<label for="serviceManager" class="control-label"><%= _.capitalize(lang.manager) %>:</label>

					<div class="controls">
						<select id="serviceManager"></select>
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Service Parent Service -->
				<div class="control-group">
					<label for="serviceParentService" class="control-label"><%= _.capitalize(lang.parentService) %>:</label>

					<div class="controls">
						<select id="serviceParentService"></select>
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Service is Technical Service -->
				<div class="control-group">
					<div class="controls">
						<label for="serviceIsTechnical" class="checkbox"><%= _.capitalize(lang.technicalService) %>
							<input type="checkbox" id="serviceIsTechnical" />
						</label>
					</div>
				</div>

			</fieldset>

		</form>
	</div>
	
	<div class="modal-footer">
		<button type="submit" form="formAddService" class="btn btn-primary saveTask"><%= _.capitalize(lang.actions.save) %></button>&nbsp;&nbsp;
		<a href="#" data-dismiss="modal"><%= _.capitalize(lang.actions.cancel) %></a>
	</div>
</div>


<!-- Modal Form Delete Place -->
<div id="modalDeleteService" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Suppression du service</h3>
	</div>
	
	<div class="modal-body">

		<blockquote id="infoModalDeleteService" class="spaceBottom">
			<p></p>
			<small></small>
		</blockquote>

		<p>Etes-vous s√ªr de vouloir supprimer ce service ?</p>
	</div>
	
	<div class="modal-footer">
	    <button type="button" class="btn btn-danger btnDeleteService"><%= _.capitalize(lang.actions.delete) %></button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal"><%= _.capitalize(lang.actions.cancel) %></a>
	</div>
</div>



<!-- Modal Form to Save a new Officer -->
<div id="modalSaveOfficer" class="modal hide fade">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3></h3>
	</div>
	
	<div class="modal-body">
		<form id="formSaveOfficer" action="#" class="form-horizontal">

			<fieldset>
				<legend><%= lang.aboutTheOfficer %></legend>

				<!-- Officer firstname -->
				<div class="control-group">
					<label for="officerFirstname" class="control-label"><%= _.capitalize(lang.firstname) %>:</label>

					<div class="controls">
						<input type="text" id="officerFirstname" name="officerFirstname" required="required" />
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Officer name -->
				<div class="control-group">
					<label for="officerName" class="control-label"><%= _.capitalize(lang.name) %>:</label>

					<div class="controls">
						<input type="text" id="officerName" name="officerName" required="required" />
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Officer email -->
				<div class="control-group">
					<label for="officerEmail" class="control-label"><%= _.capitalize(lang.email) %>:</label>

					<div class="controls">
						<input type="email" id="officerEmail" name="officerEmail" />
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Team Foreman -->
				<div class="control-group">
					<label for="officerGroup" class="control-label"><%= _.capitalize(lang.group) %>:</label>

					<div class="controls">
						<select id="officerGroup" required aria-required="true"><option></option></select>
						<span class="help-inline"></span>
					</div>
				</div>
				
				<!-- Service officer -->
				<div class="control-group">
					<label for="officerService" class="control-label"><%= _.capitalize(lang.service) %>:</label>

					<div class="controls">
						<select id="officerService"></select>
						<span class="help-inline"></span>
					</div>
				</div>

			</fieldset>

			<fieldset>
				<legend><%= _.capitalize(lang.connection) %></legend>
				
				<!-- Officer login -->
				<div class="control-group">
					<label for="officerLogin" class="control-label"><%= _.capitalize(lang.login) %>:</label>

					<div class="controls">
						<input type="text" id="officerLogin" name="officerLogin" required="required" />
						<span class="help-inline"></span>
					</div>
				</div>

				<!-- Officer password -->
				<div class="control-group">
					<label for="officerPassword" class="control-label"><%= _.capitalize(lang.password) %>:</label>

					<div class="controls">
						<input type="password" id="officerPassword" name="officerPassword" pattern=".{6,}" required="required" />
						<span class="help-inline"><%= lang.infoMessages.sixCharMin %></span>
					</div>
				</div>

			</fieldset>
			
			<!-- Services Management -->
			<div class="row-fluid marginTop servicesDroppableArea">
				
				<div class="span6">
					<div class="widget-title">
						<h4>Services de l'agent <span class="badge pull-right"></span></h4>
					</div>
					
					<ul id="officerServices" class="sortableServicesList sortable unstyled nav nav-list">
	
					</ul>
				</div>
	
				<div class="span6">
					<div class="widget-title">
						<h4>Autres services <span class="badge pull-right" id="badgeNbServices"></span></h4>
					</div>
	
					<ul id="servicesList" class="sortableServicesList sortable unstyled nav nav-list">
					</ul>
				</div>
	
			</div>
			

		</form>
	</div>
	
	<div class="modal-footer">
		<button type="submit" form="formSaveOfficer" class="btn btn-primary saveTask"><%= _.capitalize(lang.actions.save) %></button>&nbsp;&nbsp;
		<a href="#" data-dismiss="modal"><%= _.capitalize(lang.actions.cancel) %></a>
	</div>
</div>


<!-- Modal Form Delete officer -->
<div id="modalDeleteOfficer" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Suppression de l'agent</h3>
	</div>
	
	<div class="modal-body">

		<blockquote id="infoModalDeleteOfficer" class="spaceBottom">
			<p></p>
			<small></small>
		</blockquote>

		<p><%= lang.warningMessages.confirmDeleteAgent %></p>
	</div>
	
	<div class="modal-footer">
	    <button type="button" class="btn btn-danger btnDeleteOfficer"><%= _.capitalize(lang.actions.delete) %></button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal"><%= _.capitalize(lang.actions.cancel) %></a>
	</div>
</div>