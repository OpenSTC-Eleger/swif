<div class="page-header" style="margin-top: 5px">
	<h1 style="margin: 0;"><%= lang.viewsTitles.planning %></h1>
</div>


	
		
		<!-- Interventions List -->
			 <div class="row-fluid">
	     	 	<div class="span3">
					<div class="row-fluid">
						<!-- Table toolbar -->
							<div class="span6" >
								<button class="btn btn-primary no-outline addInterventionPlanning" rel="tooltip" 
										data-original-title="<%= _.capitalize(lang.actions.addIntervention) %>" data-placement="right">
											<i class="icon-plus-sign"></i> <%= _.capitalize(lang.actions.addIntervention) %>
								</button><br />
							</div>
							<div class="dropdown span1" style="height: 170px;">
									
								    <a id="filterStateIntervention" style="text-decoration:none;bottom:0;position:absolute"
								    	 class="dropdown-toggle filter-button" data-toggle="dropdown" href="#">
								   	<i class="icon-filter icon-large"> <%= _.capitalize(lang.status) %></a></i>
								    
								    
								    <ul id="filterStateInterventionList" class="dropdown-menu" role="menu" aria-labelledby="filterStateIntervention">
										<% _.each(interventionsState, function (state, i) { %>
											<li role="menuitem">
												<a tabindex="-1" href="#<%= state.value %>"> 
													<i class="badge <%= (state.color != '' ? 'badge-'+state.color : '') %>">&nbsp;</i>
													&nbsp; <%= _.capitalize(state.traduction) %>
												</a>
											</li>
										<% }) %>
											<li class="divider"></li>
											<li class="delete-filter disabled"><a href="#delete-filter"><%= _.capitalize(lang.deleteFilter) %></a></li>
									</ul>
							</div>
						
							<!--<a href="#modalAddInter" class="btn btn-primary" data-toggle="modal"><i class="icon-plus-sign"></i> <%= _.capitalize(lang.actions.addIntervention) %></a>	
							
							<ul id="listInters" class="unstyled inline nav nav-list">
								<% _.each(interventions, function (inter, i) { %>
									<li><a href="#"><i class="icon-pushpin"></i><%= inter.name %></a></li>
								<% }) %>
							</ul>
							-->
			
							<!-- <div class="btn-group" data-toggle="buttons-radio">
			    				<button type="button" class="btn">A planifier</button>
								<button type="button" class="btn">planification cloturée</button>
			    				<button type="button" class="btn">Toutes</button>
			    			</div>
			
			    			<select>
								<option>Toutes</option>
			    				<option>A planifier</option>
			    				<option>planification cloturée</option>
			    			</select>  -->
						</div>
					</div>
					
				<!-- List Officer/Teams -->
				<div class="span9" id="listAgentsTeams" class="tabbable tabs-left">
					<ul class="nav nav-tabs" id="allTabs">
						<li class="active">
							<a href="#" data-target="#tab-agents" data-toggle="tab" class="no-outline"><%= _.capitalize(lang.agents) %> &nbsp;&nbsp;<span class="badge"><%= _.size(officers) %></span></a>
						</li>
						<li>
							<a href="#" data-target="#tab-teams" data-toggle="tab" class="no-outline"><%= _.capitalize(lang.teams) %>&nbsp;&nbsp;<span class="badge"><%= _.size(teams) %></span></a>
						</li>
					</ul>

					<div class="tab-content">
						<!-- Officers -->
						<div class="tab-pane active" id="tab-agents">
							<ul id="listAgents" class="unstyled inline nav nav-list" >
								<%_.each(officers, function (officer, i) { %>
									<li><a id="pOfficer_<%= officer.id %>" href="#planning/agent/<%= _.slugify(officer.firstname)%>-<%= _.slugify(officer.name)%>"><i class="icon-user"></i><%= officer.firstname %> &nbsp;<%= officer.name %></a></li>
								<% }) %>
							</ul>
						</div>
	
						<!-- Teams -->
						<div class="tab-pane" id="tab-teams">
							<ul id="listTeams" class="unstyled inline nav nav-list">
								<%_.each(teams, function (team, i) { %>
									<li><a id="pTeam_<%= team.id %>" href="#planning/team/<%= _.slugify(team.name)%>"><i class="icon-group"></i><%= team.name %></a></li>
								<% }) %>	
							</ul>
						</div>
				  	</div>
				</div>
				<!-- /List Officer/Teams -->
			</div>

			
		
			<div class="row-fluid">
	     	 	<div class="span3">
	     	 		<!-- Table toolbar -->	
					<% if( _.size(interventions) > 0 ) { %>				
					<aside class="accordion" id="accordionInter" style="overflow-y: scroll; max-height: 590px; margin-bottom: 0;">
		
						<% _.each(interventions, function (inter, i) { %>
						<div class="accordion-group">
							<div class="accordion-heading">
								<a class="accordion-toggle no-outline" data-toggle="collapse" data-parent="#accordionInter" href="#collapse_<%= inter.id %>">
									<i class="icon-pushpin"></i>&nbsp; <strong><%= inter.name %></strong>
									<% 
										var color = "";
										_.each(interventionsState, function (state, i) { 
											if( inter.state == state.value ) {
												color = state.color;
											}
										});	
									
										if( inter.planned_hours != false && inter.state!='template' ) { %>																			
											<span class="badge <%= (color != '' ? 'badge-'+color : '') %> pull-right"><%= inter.planned_hours %>h</span>
										<% } else {%>
											<span class="badge <%= (color != '' ? 'badge-'+color : '') %> pull-right"><%= "Aucunes tâches" %></span>								
										<% } %>
								</a>
								
								<p class="intervention-actions invisible">
									<a href="#interventions/<%= inter.id %>"><i class="icon-pencil"></i>&nbsp;<%= _.capitalize(lang.actions.update) %></a> 
									<% if( inter.state == app.Models.Intervention.state[1].value ) { %>
										<a href="#modalCancelInter" class="buttonCancelInter" data-toggle="modal"><i class="icon-remove"></i>&nbsp;<%= _.capitalize(lang.actions.cancel) %></a>
									<% } else if( inter.state == app.Models.Intervention.state[4].value ) { %>
										<a href="#" class="buttonReopenInter" data-toggle="modal"><i class="icon-remove"></i>&nbsp;<%= _.capitalize(lang.actions.reopen) %></a>
									<%	} %> 
									<!--  <a href="#modalDeleteInter" class="modalDeleteInter" data-toggle="modal"><i class="icon-remove"></i>&nbsp;<%= _.capitalize(lang.actions.delete) %></a> -->
								</p>
							</div>
							<% if( inter.state != app.Models.Intervention.state[4].value ) { %>
								<div id="collapse_<%= inter.id %>" class="accordion-body collapse">
									<div class="accordion-inner">
										<ul class="unstyled tasks">
											<!-- Loop Each Tasks -->
											<% 
												var allPlanned = true;
												
												if( inter.state=='template' ) { 
														console.debug("INTER ID TEMPLATE:"+inter.id);
														_.each(inter.tasks, function (task, i) { 
															console.debug("ID TASK:"+task.id+"NAME TASK:"+task.name+"PARENT:"+task.parent_id+"HOURS"+task.planned_hours);
															if( !task.parent_id){ %>
															<li id="task_<%= task.id %>" class="external-event">&nbsp;
																	<strong><%= task.name %></strong>
																	<small class="badge pull-right"><%= task.planned_hours %>h</small>
															<% } %>
														<% }); %>											
			
												<% }else {
													_.each(inter.tasks, function (task, i) { 

														if( task.planned_hours > 0 ){
																if(task.date_start != '' && task.date_start != false && task.date_start != null && task.date_start != 'undefined' && task.date_start != 'Invalid '){ %>
																<li id="task_<%= task.id %>" class="external-event disabled ui-widget-header">
																	<i class="icon-time"></i>&nbsp;
																	<span class="<%= (task.progress == '100' ? 'isCheck' : '') %>"><%= task.name %></span>&nbsp;
																	<small class="pull-right"><%= task.planned_hours %>h</small>
															<% 
																
															} else{ %>
																<li id="task_<%= task.id %>" class="external-event">&nbsp;
																	<strong><%= task.name %></strong>
																	<small class="badge pull-right"><%= task.planned_hours %>h</small>
															<% 										
																allPlanned = false;
															}  %>
															<% if( task.state == app.Models.Task.state[0].value ) { %>
																<p class="task-actions">												
																	<a href="#modalDeleteTask" class="modalDeleteTask" data-toggle="modal">
																		<i class="icon-remove"></i>&nbsp;<%= _.capitalize(lang.actions.delete) %>
																	</a>
																</p>
															<% } %>
														<% } %>
													<% });  %>
												<% } %>
										</ul>
			
										<div class="div-actions">
											<button class="btn btn-primary btn-small no-outline addTaskPlanning" id="<%= inter.id %>" rel="tooltip" 
												data-original-title="<%= _.capitalize(lang.actions.addTask) %>" data-placement="top"
												<%= ( inter.state != app.Models.Intervention.state[0].value && inter.state != app.Models.Intervention.state[2].value  ) ? "" : 'disabled' %>>
												<i class="icon-plus"></i>
											</button>								

											<!--<button 
												class="btn btn-success btn-small pull-right no-outline" rel="tooltip" 
													data-original-title="<%= _.capitalize(lang.actions.enclosePlanning) %>" 
													data-placement="left" style="margin-right: 5px" name="enclose"
													<%= ( (allPlanned && 
															(	inter.state == app.Models.Intervention.state[1].value ||
																inter.state == app.Models.Intervention.state[3].value
															) && _.size(inter.tasks) > 0) ) ? "" : 'disabled' %>>
												<i class="icon-check"></i>
											</button>
											
											<button 
												class="btn btn-inverse btn-small pull-right no-outline" rel="tooltip" 
													data-original-title="<%= _.capitalize(lang.actions.openPlanning) %>" 
													 name="reopen"			
													<%= ( (
															(	inter.state == app.Models.Intervention.state[0].value
															) && _.size(inter.tasks) > 0) ) ? "" : 'disabled' %>>
												<i class="icon-check"></i>
											</button> -->


											<% if(_.size(inter.tasks) > 0){ %>
												
												<div class="switch switch-small pull-right" data-on-label="Oui" data-off-label="Non" data-on="primary" data-off="warning"  rel="tooltip" data-original-title="<%= _.capitalize(lang.planningFenced) %>" data-placement="top">
													<input type="checkbox" <%= ( (allPlanned && 
																(	inter.state == app.Models.Intervention.state[1].value ||
																	inter.state == app.Models.Intervention.state[3].value
																) && _.size(inter.tasks) > 0) ) ? "" : 'checked' %>>
												</div>

											<% } %>
											

											<!--<label class="checkbox toggle candy" style="width: 100px">
												<input id="view" type="checkbox">
												<p>Planification cloturées
													<span>Oui</span>
													<span>Non</span>
												</p>
												<a class="slide-button"></a>
											</label>-->
										</div>

									</div>
								</div>
							<% }%>
						</div>
						<% }) %>
		
					</aside>
					<% }else { %>
						<!-- No request in the Database -->
						<div class="alert alert-info">
							<i class="icon-info-sign icon-large"></i> &nbsp;<%= lang.infoMessages.noRequest %>.
						</div>
					<% } %>
	     	 	</div>	
	     	 	<div class="span9">
	     	 		<!-- Calendar -->
					<div style="overflow: hidden; max-height: 590px;">
					
						<%_.each(officers, function (officer, i) { %>
							<section id="planning/agent/<%= _.slugify(officer.firstname)%>-<%= _.slugify(officer.name)%>" class="calendarContainer">
								<div id="officer_<%= officer.id %>" class="calendar thumbnail" 
									data-username="<%= officer.firstname %> &nbsp;<%= officer.name %>">
								</div>
							</section>
						<% }) %>
					
						<%_.each(teams, function (team, j) { 	%>
							<section id="planning/team/<%= _.slugify(team.name)%>" class="calendarContainer">
								<div id="team_<%= team.id %>" class="calendar thumbnail" data-username="<%= team.name %>"></div>
							</section>
						<%}); %>
		
					</div>
					<!-- /Calendar -->
	     	 	</div>	
	    	</div>
	    
	
		



<!-- Modal Form Cancel Intervention -->
<div id="modalAbsentTask" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Abscence</h3>
	</div>
	
	<div class="modal-body custom-height-modal">

		<blockquote id="infoModalAbsentTask" class="spaceBottom">
			<p></p>
			<small></small>
		</blockquote>

	    <form id="formAbsentTask" action="#" class="form-inline">
	    	<div class="control-group">
				<label for="absentType" class="control-label"><%= _.capitalize(lang.type) %>:</label>

				<div class="controls">
					<select id="absentType" required="required"></select>
					<span class="help-inline"></span>
				</div>
			</div>
	    
	    
             <div class="input-append">
             
             	 <div class="control-group">
                    <label class="control-label" for="startDate"><%= _.capitalize(lang.dateStart) %>:</label>
                   <div class="controls">
                        <input 
                        	type="text"
                            class="datepicker" 
                            id="startDate" 
                            size="20"
                            value="" 
                            required="required">
                        <span class="add-on"><i class="icon-calendar"></i></span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" for="endDate"><%= _.capitalize(lang.dateEnd) %>:</label>
                    <div class="controls">
                        <input 
                        	type="text"
                            class="datepicker" 
                            id="endDate"
                            size="2à" 
                            value="" 
                            placeholder="dd/mm/yyyy"
                            required="required">
                        <span class="add-on"><i class="icon-calendar"></i></span>
                    </div>
                </div>
                
            </div>   
            
            <div class="input-append">
            
            	<div class="control-group">
                	<label for="startHour" class="control-label">@</label>
                	<div class="controls">
						<div class="input-append bootstrap-timepicker" >							
						    <input type="text" class="timepicker-default input-small" id='startHour' required="required">
						    <span class="add-on">
						        <i class="icon-time"></i>
						    </span>
						</div>
                	</div>
				</div>
             
             	<div class="control-group">
                	<label for="endHour" class="control-label">@</label>
                	<div class="controls">
						<div class="input-append bootstrap-timepicker" >							
						    <input type="text" class="timepicker-default input-small" id='endHour' required="required">
						    <span class="add-on">
						        <i class="icon-time"></i>
						    </span>
						</div>
                	</div>
				</div>
                
            </div>  
                               
	    </form>
	</div>
	
	<div class="modal-footer">
	    <button type="submit" form="formAbsentTask" class="btn btn-primary okButton" id="okButton">Enregistrer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal" class='dismiss'>Annuler</a>
	</div>
</div>


<!-- Modal Form Cancel Intervention -->
<div id="modalCancelInter" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Annuler l'intervention</h3>
	</div>
	
	<div class="modal-body">

		<blockquote id="infoModalCancelInter" class="spaceBottom">
			<p></p>
			<small></small>
		</blockquote>

	    <form id="formCancelInter" action="#" class="form-horizontal">
	    
			<!-- Request refuse motif -->
            <div class="control-group">
                <label for="motifCancel" class="control-label">Motif:</label>

                <div class="controls">
                    <textarea id="motifCancel" rows="5" required="required" placeholder="Entrée les motifs de l'annulation de l'intervention"></textarea>
                    <span class="help-inline"></span>
                </div>
            </div>
	    </form>
	</div>
	
	<div class="modal-footer">
	    <button type="submit" form="formCancelInter" class="btn btn-primary">Enregistrer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal">Annuler</a>
	</div>
</div>

<!-- Modal Form Delete Task -->
<div id="modalDeleteTask" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Suppression de la tâche</h3>
	</div>
	
	<div class="modal-body">

		<blockquote id="infoModalDeleteTask" class="spaceBottom">
			<p></p>
			<small></small>
		</blockquote>

		<p>Etes-vous sûr de vouloir supprimer cette tâche ?</p>
	</div>
	
	<div class="modal-footer">
	    <button type="button" class="btn btn-danger btnDeleteTask">Supprimer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal">Annuler</a>
	</div>
</div>



<!-- Form to add a new Task -->
<div id="modalAddTask" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Nouvelle tâche</h3>
	</div>
	
	<div class="modal-body custom-height-modal">
	    <form id="formAddTask" action="#" class="form-horizontal">
	    
			<!-- Task name -->
            <div class="control-group">
                <label for="taskName" class="control-label">Nom:</label>

                <div class="controls">
                    <input type="text" id="taskName" name="taskName" required="required"/>
                    <span class="help-inline"></span>
                </div>
            </div>
            
            <!-- Task hour -->           
           	<div class="control-group">
               	<label for="taskHour" class="control-label">Heures estimées:</label>
               	<div class="controls">
					<div class="input-append bootstrap-timepicker" >							
					    <input type="text" value="00:00" class="timepicker-default input-small" id='taskHour' required="required">
					    <span class="add-on">
					        <i class="icon-time"></i>
					    </span>
					</div>
				</div>
			</div>

            <!-- Task Category -->
            <div class="control-group">
                <label for="taskCategory" class="control-label">Catégorie:</label>

                <div class="controls">
                     <select id="taskCategory"></select>
                    <span class="help-inline"></span>
                </div>
            </div>
            
            <!-- Equipment -->
            <!-- <div class="control-group">
				<label for="taskEquipment" class="control-label"><%= _.capitalize(lang.equipment) %>:</label>

				<div class="controls">
					<select id="taskEquipment"></select>
					<span class="help-inline"></span>
				</div>
			</div>  -->

	    </form>
	</div>
	
	<div class="modal-footer">
	    <button type="submit" form="formAddTask"  class="btn btn-primary">Enregistrer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal">Annuler</a>
	</div>
</div>


<!-- Form to add a new Intervention -->
<div id="modalAddInter" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Nouvelle intervention</h3>
	</div>
	
	<div class="modal-body">
	    <form id="formAddIntervention" action="#" class="form-horizontal">
	    
                <!-- intervention Name -->
                <div class="control-group">
                    <label for="interventionName" class="control-label"><%= _.capitalize(lang.label) %>:</label>

                    <div class="controls">
                        <input type="text" id="interventionName" name="interventionName" required="required" />
                        <span class="help-inline"></span>
                    </div>
                    
                    <div class="controls">
						<label for="isTemplate" class="checkbox"><%= _.capitalize(lang.template) %>
							<input type="checkbox" id="isTemplate" />
						</label>
					</div>
                </div>
                
               <div class="control-group">

				</div>
                
                <!-- intervention Description -->
                <div class="control-group">
                    <label for="interventionDescription" class="control-label"><%= _.capitalize(lang.description) %>:</label>

                    <div class="controls">
                        <textarea name="interventionDescription" id="interventionDescription" rows="5" required="required"></textarea>
                        <span class="help-inline"></span>
                    </div>
                </div>

                <!-- intervention DeadLine -->
                <!-- <div class="control-group">
                    <label class="control-label" for="interventionDeadline"><%= _.capitalize(lang.Deadline) %>:</label>
                    <div class="controls">
                        <input 
                            type="text" class="Picker" 
                            id="interventionDeadline" 
                            value="" 
                            placeholder="dd/mm/yyyy"
                            required="required"
                            readonly="readonly">
                        <span class="help-inline"></span>
                    </div>
                </div>
                 -->
                
                <!-- intervention Contact Service -->
                <div class="control-group">
                    <label for="interventionDetailService" class="control-label"><%= lang.serviceConcerned %>:</label>

                    <div class="controls">
                        <select id="interventionDetailService"></select>
                        <span class="help-inline"></span>
                    </div>
                </div>
                
                <!-- intervention Place -->
                <div class="control-group">
                    <label for="interventionPlace" class="control-label"><%= _.capitalize(lang.place) %>:</label>

                    <div class="controls">  
                        <select id="interventionPlace"><option value="" disabled="disabled" ></option></select>
                        <span class="help-inline"></span>                           
                    </div>
                </div>
                
                <!-- intervention Place precision -->
                <div class="control-group">
                    <label for="interventionPlacePrecision" class="control-label"><%= _.capitalize(lang.informationOfTheSite) %>:</label>

                    <div class="controls">  
                         <textarea name="interventionPlacePrecision" id="interventionPlacePrecision" rows="2"></textarea>
                        <span class="help-inline"></span>                           
                    </div>
                </div>

	    </form>
	</div>
	
	<div class="modal-footer">
	    <button type="submit" form="formAddIntervention" class="btn btn-primary saveInterventionPlanning">Enregistrer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal">Annuler</a>
	</div>
</div>










<!-- Form to print paperboard-->
<div id="printContainer" class="hide">
	<h1>Fiche d'intervention: <input type="text" id="worker" disabled="disabled"/></h1> 
	<!-- <table cellpadding="0" cellspacing="0" border="0" class="bordered-table zebra-striped" id="example">  -->
	<!--  <table  class="table table-striped table-bordered" border="1" id="example" width="100%"> -->
    <div class="span8 offset1">
        <table  class="table table-striped table-bordered" border="1" id="paperboard" width="100%">
	    <thead>
	        <tr>
	        	<th>Libelle</th>
	        	<th>Intervention</th>	            
	            <th>Site</th>
	            <th style="width: 100px" > début</th>
	            <th> fin</th>	         
	            <th>Temps estimé</th>
	            <th>Temps effectué</th>
	            <th>Temps restant estimé par l'agent</th>
	            <th>Fait</th>
	            <th>Matériel</th>
	            <th>Carburant</th>
	        </tr>
	    </thead>
	</table>
	</div>
</div>









