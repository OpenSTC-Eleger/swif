<div class="page-header">
	<h1>
		Interventions
		<sup>
			<i class="badge badge-success" >
				<%= nbInterventions %>
			</i>
		</sup>
	</h1>
</div>


<div class="container-fluid">

	<!-- Check if there is Request in the Database -->
	<% if(interventions.length != 0) { %>

		<!-- Table toolbar -->
		<div class="tableToolbar">
			<a href="#" class="btn btn-primary"><i class="icon-plus-sign"></i> <%= _.capitalize(lang.actions.addIntervention) %></a>	

			<form class="form-search pull-right">
    			<div class="input-append">
					<input type="search" class="input-medium search-query" placeholder="<%= lang.actions.search %>..." autocomplete="off">
					<button type="submit" class="btn"><i class="icon-search icon-large"></i></button>
				</div>
			</form>
		</div>
		<!-- Table toolbar -->
		
		
		
		<!-- Table Requests -->
		<div id="accordion2" class="accordion"></div>
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th><%= _.capitalize(lang.label) %></th>
					<th>Responsable</th>
					<th>Temps planifié</th>
					<th>Temps passé</th>
					<th>Avancement</th>
				</tr>
			</thead>
			<tbody>
				<% _.each(interventions, function (intervention, i) { %>
							<tr class="accordion" >	
								<td>
									<div class="accordion-group" >
										<div class="accordion-heading">
											<a class="accordion-toggle" data-toggle="collapse" data-parent="accordion2" href="#collapse_<%= intervention.id %>">
													<%= intervention.name %>
											</a>
										</div>
									</div>
								</td>	
								<td><%=intervention.ask.manager_id[1]%></td>
							    <td><%=intervention.planned_hours%></td>
							    <td><%=intervention.total_hours%></td>
							    <td>
							    	<div class="progress" style="margin-bottom: 0;">
							    		<div class="bar" style="width: 70%;"><%= intervention.progress_rate %></div>
							    	</div>
							    </td>							   
							</tr>
							<tr>							
								<td colspan="5">
									<div class="accordion-body collapse" id="collapse_<%= intervention.id %>" >
										<div class="accordion-inner">
											<table class="table table-striped table-bordered table-hover">
												<tbody>	
													<% 
													var allPlanned = false;
													_.each(intervention.tasks, function (task, i) { 
														if(task.date_start != ""){ %>
														<tr id="task<%= task.id %>" class="external-event disabled" colspan="4" >
																<td><i class="icon-time"></i>&nbsp;
																<%= task.name %>
																<small class="pull-right"><%= task.planned_hours %>h</small>
														<% 
															allPlanned = true;
														} else{ %>
															<tr id="task<%= task.id %>" class="external-event" colspan="4">
																<td>&nbsp;<%= task.name %>
																<small class="badge pull-right"><%= task.planned_hours %>h</small>
														<% 
															allPlanned = false;
														}  %>
														<p class="task-actions invisible">
															<a href="#"><i class="icon-pencil"></i>&nbsp;<small><%= _.capitalize(lang.actions.update) %></small></a> |
															<a href="#modalDeleteTask" data-toggle="modal"><i class="icon-remove"></i>&nbsp;<small><%= _.capitalize(lang.actions.delete) %></small></a>
														</p>
														</td>

														</tr>
													<% }); %>
																											
													<div class="div-actions" >
														<button class="btn btn-primary btn-small no-outline addTask" 
															id="<%= intervention.id %>" rel="tooltip" data-original-title="<%= _.capitalize(lang.actions.addTask) %>" data-placement="right">
															<i class="icon-plus"></i>
														</button>
													</div>
												</tbody>
											 </table>	
										</div>
									</div>										 
						    	</td>
						    </tr>					  						
				<% }); %>
			</tbody>
		</table>
	<% } 
	else { %>
		<!-- No request in the Database -->
		<div class="alert alert-info">
			<i class="icon-info-sign icon-large"></i> &nbsp;<%= lang.infoMessages.noRequest %>.
		</div>

	<% } %>

</div>


<!-- Form to add a new Task -->
<div id="modalAddTask" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Nouvelle tâche</h3>
	</div>
	
	<div class="modal-body">
	    <form id="formAddTask" action="#" class="form-horizontal">
	    
			<!-- Task name -->
            <div class="control-group">
                <label for="taskName" class="control-label">Nom:</label>

                <div class="controls">
                    <input type="text" id="taskName" name="taskName" />
                    <span class="help-inline"></span>
                </div>
            </div>

            <!-- Task Category -->
            <div class="control-group">
                <label for="taskCategory" class="control-label">Catégorie:</label>

                <div class="controls">
                     <select id="taskCategory"></select>
                    <span class="help-inline"></span>
                </div>
            </div>

			<!-- Task hour -->
            <div class="control-group">
                <label for="taskHour" class="control-label">Heures prévisionnelles:</label>

                <div class="controls">
                     <input type="number" id="taskHour" name="taskHour" />
                    <span class="help-inline"></span>
                </div>
            </div>

	    </form>
	</div>
	
	<div class="modal-footer">
	    <button type="submit" class="btn btn-primary saveTask">Enregistrer</button>&nbsp;&nbsp;
	    <a href="#" data-dismiss="modal">Annuler</a>
	</div>
</div>
		
