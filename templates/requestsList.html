<div class="page-header">
	<h1>
		<%= lang.viewsTitles.requestsList %>
		<sup rel="tooltip" data-original-title="<%= lang.wait %>">
			<i class="badge badge-info" >
				<%= nbInterventionsWaiting %>
			</i>
		</sup>
	</h1>
</div>


<div class="container-fluid">

	<!-- Check if there is Request in the Database -->
	<% if(requests.length != 0) { %>

		<!-- Table toolbar -->
		<div class="tableToolbar">
			<a href="#demandes-dinterventions/add" class="btn btn-primary"><i class="icon-plus-sign"></i> <%= _.capitalize(lang.actions.addRequest) %></a>	

			<form class="form-search pull-right">
    			<div class="input-append">
					<input type="search" class="input-medium search-query" placeholder="<%= lang.actions.search %>..." autocomplete="off">
					<button type="submit" class="btn"><i class="icon-search icon-large"></i></button>
				</div>
			</form>
		</div>
		<!-- Table toolbar -->


		<!-- Table Requests -->
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th><%= _.capitalize(lang.label) %></th>
					<th class="hidden-phone"><%= _.capitalize(lang.place) %></th>
					<th><%= _.capitalize(lang.service) %></th>
					<th><%= _.capitalize(lang.claiment) %></th>
					<th><%= _.capitalize(lang.dateRequest) %> <!--<a id="orderDateRequest" href="#" class="pull-right"><i class="icon-caret-down icon-large"></i></a>--></th>
					<th>
						<%= _.capitalize(lang.status) %> 
						    <div class="dropdown pull-right">
							    <a id="filterStateRequest" class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-filter icon-large muted"></i></a>
							    
							    <ul class="dropdown-menu" role="menu" aria-labelledby="filterStateRequest">
									<% _.each(requestsState, function (state, i) { %>
										<li role="menuitem">
											<a tabindex="-1" href="#demandes-dinterventions/filter/state/<%= state.value %>"> 
												<i class="badge <%= (state.color != '' ? 'badge-'+state.color : '') %>">&nbsp;</i>
												&nbsp; <%= _.capitalize(state.traduction) %></a></li>
									<% }) %>
								</ul>
						</div>
					</th>
				</tr>
			</thead>
			<tbody>
				<% for (var i = startPos; i < endPos; i++) { %>
					<tr>
					    <td>
					    	<a  href="#demandes-dinterventions/<%= requests[i].id %>" 
					    		rel="popover" 
					    		data-content="<%= (requests[i].description != '' ? requests[i].description : _.capitalize(lang.notKnown)) %>" 
					    		data-original-title="<%= _.capitalize(lang.description) %>:">
					    		<%= requests[i].name %>
					    	</a>
					    </td>
					    <td><%= (requests[i].site1 != false ? _(requests[i].site1[1].toLowerCase()).titleize() : "") %></td>
					    <td class="hidden-phone">
					    	<span 
					    		rel="tooltip"
					    		data-original-title="<%= _.capitalize(lang.toValidateBy) %> <%= (requests[i].manager_id != false ? requests[i].manager_id[1] : _.capitalize(lang.notKnown)) %>">
					    		<%= requests[i].service_id[1] %>
					    	</span>
					    </td>
					    <td><%= requests[i].partner_id[1] %></td>
					    <td>
					    	<span 
					    		rel="tooltip"
					    		data-original-title="<%= moment(requests[i].current_date, 'YYYY-MM-DD HH:mm:ss').fromNow() %>">
					    		<%= moment(requests[i].current_date, 'YYYY-MM-DD HH:mm:ss').format('LLL') %>
					    	</span>
					    </td>
					    <td>
				    		<% if(requests[i].state == openstm.Models.Request.state[0].value) { %> 
				    			<span class="label label-important"><%= lang.refused %></span>
				    		<% } else if(requests[i].state == openstm.Models.Request.state[1].value) { %>
				    			<span class="label label-info"><%= lang.wait %></span>
				    		<% } else if(requests[i].state == openstm.Models.Request.state[2].value) { %>
				    			<span class="label label-warning"><%= lang.confirm %></span>
				    		<% } else if(requests[i].state == openstm.Models.Request.state[3].value) { %>
				    			<span class="label label-success"><%= lang.valid %></span>
				    		<% } else if(requests[i].state == openstm.Models.Request.state[4].value) { %>
				    			<span class="label label"><%= lang.closed %></span>
				    		<% } %>
					   	</td>
					</tr>
				<% } %>
			</tbody>
		</table>
		<!-- /Table Requests -->


		<!-- Table pagination -->
		<div class="pagination pagination-right">
			<ul>
				<!-- First page button -->
				<% if(page-2 >= 1){ %>
					<li <%= ((page - 1) == 0 ? " class='disabled'" : "")%>><a href='#demandes-dinterventions/page<%= 1 %>'><%= _.capitalize(lang.actions.first) %></a></li>
				<% } %>
				
				<!-- Previous page button -->
				<li <%= ((page - 1) == 0 ? " class='disabled'" : "")%>><a href='#demandes-dinterventions/page<%=(page-1)%>'><%= _.capitalize(lang.actions.previousShort) %></a></li>
			
				<!-- [...] page Button -->
				<% 	if (page-2 > 1) { %>
						<li class="disabled"><a href='#'>...</a></li>
				<% } 
						
					for (var i=(page-2); i < (page+3); i++) {
						if(i >= 1 && i <= pageCount){ %>
							<li <%= (i === page ? " class='active'" : "")%>><a href='#demandes-dinterventions/page<%=i%>'><%= i %></a></li>
						<% }

					} %>
					
				<!-- [...] page Button -->
				<% if (page+2 < pageCount) { %>
					<li class="disabled"><a href='#'>...</a></li>
				<% } %>
				
				<!-- Next page button -->
				<li <%= ((page + 1) > pageCount ? " class='disabled'" : "")%>><a href='#demandes-dinterventions/page<%=(page+1)%>'><%= _.capitalize(lang.actions.nextShort) %></a></li>
				
				<!-- Last page button -->
				<% if(page+2 <= pageCount){ %>
					<li <%= ((page + 1) > pageCount ? " class='disabled'" : "")%>><a href='#demandes-dinterventions/page<%= pageCount %>'><%= _.capitalize(lang.actions.end) %></a></li>
				<% } %>
			</ul>
		</div>
		<!-- /Table pagination -->

	<% } 
	else { %>
		<!-- No request in the Database -->
		<div class="alert alert-info">
			<i class="icon-info-sign icon-large"></i> &nbsp;<%= lang.infoMessages.noRequest %>.
		</div>

	<% } %>

</div>


		